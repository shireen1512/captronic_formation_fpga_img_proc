(function($){$(document).ready(function(){$("textarea.commentPluginPromptBox").blur(function(){if(this.value=="")this.value=this.title}).focus(function(){if(this.value==this.title)this.value=""}).keypress(function(){var form=$(this).parents("form")[0];$(form).find(".commentPluginStatusResponse").html("")});var addComment=function(position,html,form){var relto;if(position=="TOP"){relto=$(".patternContent");if(relto.length==0)relto=$("body");relto.prepend(html);position=""}else if(position=="BOTTOM"){relto=$(".patternContent");if(relto.length==0)relto=$("body");relto.append(html);position=""}else if(form.comment_location){relto=$('*:contains("'+form.comment.location.value+'")')[0]}else if(form.comment_anchor){var anchor=form.comment_anchor.value.slice(1);relto=$("a[name='"+anchor+"'],*[id='"+anchor+"']")}else{relto=$(".commentPluginForm")[form.comment_index.value];if(relto)relto=$(relto)}if(relto&&position=="BEFORE"){relto.before(html)}else if(relto&&position=="AFTER"){relto.after(html)}else if(position!=""){$("body").append(html)}};$("input.commentPluginAjax").click(function(e){var form=$(this).parents("form")[0];$("body").css("cursor","wait");if(typeof StrikeOne!=="undefined")StrikeOne.submit(form);$.ajax({url:form.action,type:"POST",data:$(form).serialize(),beforeSend:function(){$(form).find("input[type=text], textarea").attr("disabled","disabled");$(form).find("[type=submit]").attr("disabled","disabled");$(form).find("[type=submit]").addClass("foswikiButtonDisabled")},success:function(data,textStatus,jqXHR){var position=jqXHR.getResponseHeader("X-Foswiki-Comment");addComment(position,data,form);$(form).find("input[type=text], textarea").removeAttr("disabled","disabled");$(form).find("[type=submit]").removeAttr("disabled","disabled");$(form).find("[type=submit]").removeClass("foswikiButtonDisabled");$("body").css("cursor","default");form.reset()},error:function(jqXHR,textStatus,errorThrown){if(jqXHR.responseText)alert("Error: "+jqXHR.responseText);else alert("Error: "+errorThrown);$(form).find("input[type=text], textarea").removeAttr("disabled","disabled");$(form).find("[type=submit]").removeAttr("disabled","disabled");$(form).find("[type=submit]").removeClass("foswikiButtonDisabled");$("body").css("cursor","default")},complete:function(jqXHR){var nonce=jqXHR.getResponseHeader("X-Foswiki-Validation");if(nonce){$("input[name='validation_key']").each(function(){$(this).val("?"+nonce)})}}});return false})})})(jQuery);