"use strict";!function(e,t,i){var s={};function o(t,i){this.elem=e(t),this.opts=e.extend({},s,this.elem.data(),i),this.init()}o.prototype.init=function(){var t=this;t.likeButton=t.elem.find(".jqLikeButton"),t.dislikeButton=t.elem.find(".jqDislikeButton"),t.likes=t.opts.likes,t.dislikes=t.opts.dislikes,t.elem.is(".editable")&&(t.likeButton.on("click",(function(){return t.likeButton.is(".selected")?t.vote(0):t.vote(1),!1})),t.dislikeButton.on("click",(function(){return t.dislikeButton.is(".selected")?t.vote(0):t.vote(-1),!1}))),e(i).on("change.likes",(function(e,i){void 0!==i&&i.web===t.opts.web&&i.topic===t.opts.topic&&i.metaType===t.opts.metaType&&i.metaId===t.opts.metaId&&t.update(i.likes,i.dislikes)}))},o.prototype.vote=function(t){var i=this;t=parseInt(t,10),i.hideMessages(),e.jsonRpc(foswiki.getScriptUrl("jsonrpc"),{namespace:"LikePlugin",method:"vote",params:{topic:i.opts.web+"."+i.opts.topic,type:i.opts.metaType,id:i.opts.metaId,like:t>0?1:0,dislike:t<0?1:0},beforeSend:function(){i.elem.data("blockUI.isBlocked")||i.elem.block({message:""})},success:function(e){i.elem.unblock(),i.elem.trigger("change.likes",{web:i.opts.web,topic:i.opts.topic,metaType:i.opts.metaType,metaId:i.opts.metaId,likes:e.result.likes,dislikes:e.result.dislikes})},error:function(e){i.elem.unblock(),i.showMessage("error",e.error.message),console.error(e.error.message)}})},o.prototype.update=function(e,t){var i=this.likeButton.find(".jqLikeLabel"),s=this.dislikeButton.find(".jqLikeLabel");this.likeButton.removeClass(this.opts.selectedClass),this.dislikeButton.removeClass(this.opts.selectedClass),i.html(decodeURIComponent(this.opts.likeLabel)),s.html(decodeURIComponent(this.opts.dislikeLabel)),this.likes<e&&(this.likeButton.addClass(this.opts.selectedClass),i.html(decodeURIComponent(this.opts.likedLabel))),this.dislikes<t&&(this.dislikeButton.addClass(this.opts.selectedClass),s.html(decodeURIComponent(this.opts.dislikedLabel))),this.likeButton.find(".jqLikeCount").text(e),this.dislikeButton.find(".jqLikeCount").text(t),this.likes=e,this.dislikes=t,this.elem.attr("data-likes",e),this.elem.attr("data-dislikes",t)},o.prototype.showMessage=function(t,i,s){e.pnotify({title:s,text:i,hide:"error"!==t,type:t,sticker:!1,closer_hover:!1,delay:"error"===t?8e3:2e3})},o.prototype.hideMessages=function(){e.pnotify_remove_all()},e.fn.like=function(t){return this.each((function(){e.data(this,"_like")||e.data(this,"_like",new o(this,t))}))},e(".jqLike").livequery((function(){e(this).like()}))}(jQuery,window,document);
