"use strict";!function(e){var o={debug:!1,expand:"on",render:"on",zones:"script, head",async:!1,cachecontrol:0,success:function(){},error:function(e){console&&console.error(e)}};function n(n){var t=this;t.opts=e.extend({topic:foswiki.getPreference("WEB")+"."+foswiki.getPreference("TOPIC")},o,n),t.successFunc=t.opts.success,t.errorFunc=t.opts.error,t.url=t.opts.url||foswiki.getScriptUrl("rest","RenderPlugin","jsonTemplate"),delete t.opts.success,delete t.opts.error,delete t.opts.url}function t(e,o,n,r){void 0===e||n[e.id]||(n[e.id]=1,e.requires.forEach((function(e){t(o[e],o,n,r)})),r.push(e))}n.prototype.log=function(){var o,n=this;console&&n.opts.debug&&((o=e.makeArray(arguments)).unshift("FoswikiTemplate: "),console.log.apply(n,o))},n.prototype.loadTemplate=function(){var o=this;return e.ajax({url:o.url,async:!0,data:o.opts,dataType:"json",success:function(e,n,t){o.processZones(e.zones),o.successFunc(e.expand,n,t)},error:function(e){var n=e.responseText.replace(/^ERROR: .*- /,"").replace(/ at .*/,"");o.errorFunc(n)}})},n.prototype.processZones=function(o){var n=this;Object.keys(o).forEach((function(r){var s={},c={},a=[];n.log("processing zone ",r),o[r].forEach((function(o){var n=e("."+r+"."+o.id.replace(/([^a-zA-Z0-9_-])/g,"\\$1"));"JQUERYPLUGIN::FOSWIKI::PREFERENCES"!==o.id&&0===n.length&&(s[o.id]=o)})),Object.keys(s).forEach((function(e){t(s[e],s,c,a)})),a.forEach((function(o){var t=o.text;t=n.opts.async?o.text.replace(/<script /g,"<script async "):o.text,n.log("... loading ",o.id),e("."+r).last().after(t)}))}))},foswiki.loadTemplate=function(e){return new n(e).loadTemplate()},e(document).on("click",".foswikiDialogLink",(function(){var o=e(this),n=o.attr("href")||"",t=e.extend({name:n.replace(/^#/,""),expand:"dialog"},o.data());return foswiki.loadTemplate(t).done((function(n){var t=e(n.expand);t.hide(),e("body").append(t),t.data("autoOpen",!0).on("dialogopen",(function(){o.trigger("opened")}))})),!1}))}(jQuery);
